<div	style="font-size:14">
<h2> Large and Loadable Instruction Frames</h2>

<div	style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">
Large applications  may be constructed as one or more iframes of any size collected at a load address which is either known on construction or known on load

<p>
If the load address is known on construction, then the application or library is a fixed part of the system load image

<p>
If the load address is undecided on construction, then the loader obtains and records storage for the load image and updates references between iframes in the load group. These references are few in number however large and complex the group of loaded iframes 

<p>
A loadable application of three iframes is loaded and executed here. The application is void but displays where the first and last executable pages of current iframe are at points of call and return

<p>
The three iframes of application gate are TREE1 two pages in size, TREE2 seven pages and TREE3 one page.

</div>

<pre	style="font-size:12pt">

$ telnet 172.29.7.7
Trying 172.29.7.7...
Connected to 172.29.7.7.
Escape character is '^]'.
RTA1 smaragd7 OS shared console
r load /down/more/down/more/down/gate
00002b	<a	name="loader"/>
loader: r load /down/more/down/more/down/gate

TREE1 iframe L:U pages 00002f:000030 about to call TREE2:uphere
TREE2:uphere iframe L:U pages 000031:000037 about to return
TREE1 iframe L:U pages 00002f:000030 about to call TREE2:downabit
TREE2:downabit iframe L:U pages 000031:000037 about to call TREE3:ohoh?
TREE3:ohoh? iframe L:U pages 000038:000038
TREE2:downabit iframe L:U pages 000031:000037 return from TREE3:ohoh?
TREE1 iframe L:U pages 00002f:000030 floating result +0.525e+1 about to call TREE3:ohoh?
TREE3:ohoh? iframe L:U pages 000038:000038
TREE1 return iframe L:U pages 00002f:000030


</pre>


<div	style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">
Call operands between these iframes are nested literal <a href="rta.html#gate">gate<a> constants
generated by interframe pointer macro ifrap

<p>

There are two examples of the indirectly addressed call target gate immediately before source line 60 of this assembly
</div>

<pre	style="font-size:12pt">

04:00010c+[0000]18:186F00800002
04:00010e+80010C
04:00010f+[0000]18:000114000009
04:000111+80010F

</pre>

<div    style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">

The operand of the call at line 44 is the word at 00010E. The operand of the call at line 53 is the word at 000111

<p>
These call operands are flagged indirect and point to the 48-bit gate preceding each of them

<p>
The second word (24 bits of 48) of each gate is marked awaiting a relocation value. The loader changes 800002 to Start Page Index + 800002 and 000009 to Start Page Index + 000009

<p>
Flag bit 23 of Iframe Name indicates nonzero Page High Index from bits 47..42 of the gate

<p>

Gates are not in architectural tables. This avoids the need to construct architectural tables. Gates are constants or variables, in these examples literal (automatic) constants

<p>
$application and $iframe are the same macro. $application frames can be started as processes and contain a micro-filesystem which kernel routine seg$load reads for initial data values

</div>

<pre	style="font-size:12pt">

$ masmx -lnke gate
MASMX 7r3A Build 8
3/gate.msm
*EOF*
  :                            1 
  :                            12 	$list
  :                            13 
  :                            14 .	if this is fixed equate TREES_LOADP before here
  :                            15 .	otherwise this is dynamically loadable
  :                            16 
  :                            17 __BASE	$equ	TREES_LOADP
  :                            18 
  :                            19 $(3:03000/$3)
  :                            20 
  :                            23 	$list
  :                            24 
  :                            25 $(0:/$0)
  :                            26 
  :                            27 TREE1	$tree
00:000000  B60114              +28 	$application,1	gate_vector:startup
[+0000]30
00:000040  040000 800000        +28 
00:000042  00A000              +28 
[+0001]18
00:000043  000000              +28 
00:000044  000000 000007 003000 FFFFFF
                              +28 
  :                            29 
  :                            30 	$lits4
00:000114  60207F              +31 startup	$base_d	$zenith(3)-03000 4096
00:000115  340003              +31 
00:000116  64C001              +31 
00:000117  340004              +31 
00:000118  64C001              +31 
00:000119  340005              +31 
00:00011A  600100              +31 
00:00011B  75007A              +31 
00:00011C  656000              +31 
00:00011D  20000E              +31 
00:00011E  9F0101              +32 	c	(seg$load)	0,,xi	(gate_data:d),,long
00:00011F  FD0000              +32 
00:000120  FCF003              +32 
00:000121  FF0103              +32 
00:000122  38000F              +32 
  :                            33 
00:000123  040040              +34 	inA	iframe$u
00:000124  0C0000              +35 	inB	0
00:000125  F80004              +36 	printf	$3("TREE1 iframe L:U pages %x:%x about to call TREE2:uphere":10:0),,xi	b a
00:000126  F80005              +36 
00:000127  FD4004              +36 
00:000128  FD0001              +36 
00:000129  FCF004              +36 
00:00012A  FF0104              +36 
00:00012B  38000F              +36 
  :                            37 
00:00012C  FF0107              +38 	c	ifrap(TREE2:uphere)
  :                            39 
00:00012D  040040              +40 	inA	iframe$u
00:00012E  0C0000              +41 	inB	0
00:00012F  F80004              +42 	printf	$3("TREE1 iframe L:U pages %x:%x about to call TREE2:downabit":10:0),,xi b a
00:000130  F80005              +42 
00:000131  FD4017              +42 
00:000132  FD0001              +42 
00:000133  FCF004              +42 
00:000134  FF0104              +42 
00:000135  38000F              +42 
  :                            43 
00:000136  8F0108              +44 	c	ifrap(TREE2:downabit)	(3.75),,float
00:000137  FCF004              +44 
00:000138  FF010E              +44 
00:000139  38000F              +44 
  :                            45 
00:00013A  470008              +46 	qs	8
00:00013B  040040              +47 	inA	iframe$u
00:00013C  0C0000              +48 	inB	0
                                	printf	$3("TREE1 iframe L:U pages %x:%x floating result %f ":;
00:00013D  8F0008              +50 		"about to call TREE3:ohoh?":10:0),,xi	b	a	8,,float
00:00013E  F80004              +50 
00:00013F  F80005              +50 
00:000140  FD402B              +50 
00:000141  FD0001              +50 
00:000142  FCF008              +50 
00:000143  FF0104              +50 
00:000144  38000F              +50 
  :                            51 directly** $xname
  :                            52 
00:000145  FF0111              +53 	c	ifrap(TREE3:ohoh?)
  :                            54 
00:000146  040040              +55 	inA	iframe$u
00:000147  0C0000              +56 	inB	0
00:000148  F80004              +57 	printf	$3("TREE1 return iframe L:U pages %x:%x":10:0),,xi b a
00:000149  F80005              +57 
00:00014A  FD4044              +57 
00:00014B  FD0001              +57 
00:00014C  FCF004              +57 
00:00014D  FF0104              +57 
00:00014E  38000F              +57 
00:00014F  3D0000              +58 	fret	0
  :                            59 
  :                            60 FS_BASE*	$set	$+63**-64
  :                            61 FS_SAFE_LIMIT*	$set	_NEXTP*/12
  :                            62 
Note: gate.msm Line 63: $lits4 argument can be reduced to
[$zenith-256][000000000000000000000000000000000000000000000012]
  :                            63 	$check4
  :                            64 	$root
  :                            65 
  :                            66 TREE2	$tree	
00:000000  B60115              +67 	$iframe,6	onetime:uphere	secondtime:downabit
00:000001  B66F00              +67 
[+0000]30
00:000040  180000 800002        +67 
00:000042  00A000              +67 
00:000043  000000 000000 000000 000000 000000
                              +67 
04:000100+[0001]18:000000
04:000101+[0002]30:000000000000
04:000103+0001CD
04:000104+0001DB
04:000105+[0000]18:180115800002
04:000107+800105
04:000108+400002F00000000000000000
04:00010c+[0000]18:186F00800002
04:00010e+80010C
04:00010f+[0000]18:000114000009
04:000111+80010F
  :                            68 	$lits4
00:000114  B6011E              +69 	j	here
  :                            70 uphere
00:000115  040040              +71 	inA	iframe$u
00:000116  0C0000              +72 	inB	0
00:000117  F80004              +73 	printf	$3("TREE2:uphere iframe L:U pages %x:%x about to return":10:0),,xi b a
00:000118  F80005              +73 
00:000119  FD4051              +73 
00:00011A  FD0001              +73 
00:00011B  FCF004              +73 
00:00011C  FF0100              +73 
00:00011D  38000F              +73 
00:00011E  3D0000              +74 here	fret	0
  :                            75 
  :                            76 .	a large gap forcing the size of TREE2 to 7 pages
  :                            77 
  :                            78 $(0:06F00)
  :                            79 downabit
  :                            80 	$head_far	 params(anumber,	float)
00:006F00  040040              +81 	inA	iframe$u
00:006F01  0C0000              +82 	inB	0
00:006F02  F80004              +83 	printf	$3("TREE2:downabit iframe L:U pages %x:%x about to call TREE3:ohoh?":10:0),,xi b a
00:006F03  F80005              +83 
00:006F04  FD4063              +83 
00:006F05  FD0001              +83 
00:006F06  FCF004              +83 
00:006F07  FF0100              +83 
00:006F08  38000F              +83 
  :                            84 
00:006F09  FF0103              +85 	c	ifrap(TREE3:ohoh?)
  :                            86 
00:006F0A  040040              +87 	inA	iframe$u
00:006F0B  0C0000              +88 	inB	0
00:006F0C  F80004              +89 	printf	$3("TREE2:downabit iframe L:U pages %x:%x return from TREE3:ohoh?":10:0),,xi b a
00:006F0D  F80005              +89 
00:006F0E  FD4079              +89 
00:006F0F  FD0001              +89 
00:006F10  FCF004              +89 
00:006F11  FF0100              +89 
00:006F12  38000F              +89 
00:006F13  4FF003              +90 	ql	anumber
00:006F14  670104              +91 	fa	(1.5o)
00:006F15  3D0000              +92 	fret	0
Note: gate.msm Line 93: $lits4 argument can be reduced to
[$zenith-256][00000000000000000000000000000000000000000000000c]
  :                            93 	$check4
  :                            94 	$root
  :                            95 
  :                            96 TREE3	$tree
[+0000]30
00:000040  000000 000009        +97 	$iframe	
00:000042  00A000              +97 
00:000043  000000 000000 000000 000000 000000
                              +97 
04:000100+0001DB
04:000101+[0000]18:000114000009
04:000103+800101
04:000104+400001C00000000000000000000000000000000000000000
  :                            98 	$lits4
00:000114  040040              +99 ohoh?	inA	iframe$u
00:000115  0C0000              +100 	inB	0
00:000116  F80004              +101 	printf	$3("TREE3:ohoh? iframe L:U pages %x:%x":10:0),,xi b a
00:000117  F80005              +101 
00:000118  FD408E              +101 
00:000119  FD0001              +101 
00:00011A  FCF004              +101 
00:00011B  FF0100              +101 
00:00011C  38000F              +101 
00:00011D  3D0000              +102 	fret	0
Note: gate.msm Line 103: $lits4 argument can be reduced to
[$zenith-256][000000000000000000000000000000000000000000000001]
  :                            103 	$check4
  :                            104 	$root
  :                            105 
*EOF*
03:004004+545245453120696672616D65204C3A552070616765732025
783A25782061626F757420746F2063616C6C205452454532
3A7570686572650A00
03:004017+545245453120696672616D65204C3A552070616765732025
783A25782061626F757420746F2063616C6C205452454532
3A646F776E616269740A0020
03:00402b+545245453120696672616D65204C3A552070616765732025
783A257820666C6F6174696E6720726573756C7420256620
61626F757420746F2063616C6C2054524545333A6F686F68
3F0A00
03:004044+54524545312072657475726E20696672616D65204C3A5520
70616765732025783A25780A002020
03:004051+54524545323A75706865726520696672616D65204C3A5520
70616765732025783A25782061626F757420746F20726574
75726E0A0020
03:004063+54524545323A646F776E6162697420696672616D65204C3A
552070616765732025783A25782061626F757420746F2063
616C6C2054524545333A6F686F683F0A0020
03:004079+54524545323A646F776E6162697420696672616D65204C3A
552070616765732025783A25782072657475726E2066726F
6D2054524545333A6F686F683F0A00
03:00408e+54524545333A6F686F683F20696672616D65204C3A552070
616765732025783A25780A00
04:000100+0001DB
:$(00):000000:00011E :$(02):002000:002821 :$(03):003000:00409A :$(04):000000:000101 


</pre>

<div	style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">
<p>
If the target iframe calls out to a successive iframe, for example where these iframes call each other and call printf, the gate is not retrieved on return. If popped Iframe Name bit 23 is flagged multipage then Page High Index is read from the sample gate at location 64 of iframe.


<p>
Directory rta/target.rta/image.app must be in $PATH. This application is built with script amake


</div>
<pre	style="font-size:12pt">

cd	rta/target.rta/edgecase.msm
amake	gate

</pre>
<div	style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">
 

</div>

<div	style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">
</div>

<div	style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">
</div>

<div	style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">
</div>

<div	style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">
</div>

<div	style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">
</div>

<div	style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">
</div>

<div	style="border-radius:10px;width:500pt;background-color:#EFEFEF;font-family:courier">
</div>


</div>
